<!DOCTYPE html><html><head><meta charset="UTF-8"><script src="https://cdn.jsdelivr.net/npm/prismjs/prism.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-groovy.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs/prism.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-java.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs/prism.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-kotlin.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs/prism.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-markup.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs/prism.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-none.min.js"></script><style>
        .article {
            position: relative;
            padding-bottom: 24px;
        }
        

        .bordered-element {
            border: 1px solid #c4c4c4;
            overflow: hidden;
        }
        

        .bordered-element-rounded {
            border: 1px solid #c4c4c4;
            border-radius: 7px;
            overflow: hidden;
        }
        

        .code-block {
            overflow: hidden;
            position: relative;
            padding: 0;
            border-radius: 8px;
            font-variant-ligatures: none;
            background-color: rgba(25, 25, 28, .05);
            word-break: break-all;
        }
        

        .control {
            color: #19191c;
            font-size: 16px;
            font-weight: 670;
        }
        

        .detached {
            margin-block-start: 0;
            margin-block-end: 0;
            margin-bottom: 8px;
        }
        

        .flex {
            display: flex;
        }
        

        .header-row {
            background: #e6e6e6;
        }
        

        .inline-code {
            border-radius: 4px;
            display: inline;
            padding: 2px 1px;
            font-family: JetBrains Sans,monospace;
            background: #e6e6e6;
        }
        

        .list {
            list-style-type: disc;
            padding-left: 0;
            margin-left: 15px;
        }
        

        .list-item {
            margin-top: 6px;
            margin-bottom: 6px;
            margin-left: 4px;
        }
        

        .main-title {
            padding-bottom: 24px;
            margin-top: 0;
            font-size: 40px;
            margin-block-start: 0;
            margin-block-end: 0;
        }
        

        .note {
            background: rgba(77, 187, 95, .2);
        }
        

        .prism {
            page-break-inside: avoid;
        }
        
        /* PrismJS 1.29.0
https://prismjs.com/download.html#themes=prism&languages=markup+css+clike+javascript+abap+abnf+actionscript+ada+agda+al+antlr4+apacheconf+apex+apl+applescript+aql+arduino+arff+armasm+arturo+asciidoc+aspnet+asm6502+asmatmel+autohotkey+autoit+avisynth+avro-idl+awk+bash+basic+batch+bbcode+bbj+bicep+birb+bison+bnf+bqn+brainfuck+brightscript+bro+bsl+c+csharp+cpp+cfscript+chaiscript+cil+cilkc+cilkcpp+clojure+cmake+cobol+coffeescript+concurnas+csp+cooklang+coq+crystal+css-extras+csv+cue+cypher+d+dart+dataweave+dax+dhall+diff+django+dns-zone-file+docker+dot+ebnf+editorconfig+eiffel+ejs+elixir+elm+etlua+erb+erlang+excel-formula+fsharp+factor+false+firestore-security-rules+flow+fortran+ftl+gml+gap+gcode+gdscript+gedcom+gettext+gherkin+git+glsl+gn+linker-script+go+go-module+gradle+graphql+groovy+haml+handlebars+haskell+haxe+hcl+hlsl+hoon+http+hpkp+hsts+ichigojam+icon+icu-message-format+idris+ignore+inform7+ini+io+j+java+javadoc+javadoclike+javastacktrace+jexl+jolie+jq+jsdoc+js-extras+json+json5+jsonp+jsstacktrace+js-templates+julia+keepalived+keyman+kotlin+kumir+kusto+latex+latte+less+lilypond+liquid+lisp+livescript+llvm+log+lolcode+lua+magma+makefile+markdown+markup-templating+mata+matlab+maxscript+mel+mermaid+metafont+mizar+mongodb+monkey+moonscript+n1ql+n4js+nand2tetris-hdl+naniscript+nasm+neon+nevod+nginx+nim+nix+nsis+objectivec+ocaml+odin+opencl+openqasm+oz+parigp+parser+pascal+pascaligo+psl+pcaxis+peoplecode+perl+php+phpdoc+php-extras+plant-uml+plsql+powerquery+powershell+processing+prolog+promql+properties+protobuf+pug+puppet+pure+purebasic+purescript+python+qsharp+q+qml+qore+r+racket+cshtml+jsx+tsx+reason+regex+rego+renpy+rescript+rest+rip+roboconf+robotframework+ruby+rust+sas+sass+scss+scala+scheme+shell-session+smali+smalltalk+smarty+sml+solidity+solution-file+soy+sparql+splunk-spl+sqf+sql+squirrel+stan+stata+iecst+stylus+supercollider+swift+systemd+t4-templating+t4-cs+t4-vb+tap+tcl+tt2+textile+toml+tremor+turtle+twig+typescript+typoscript+unrealscript+uorazor+uri+v+vala+vbnet+velocity+verilog+vhdl+vim+visual-basic+warpscript+wasm+web-idl+wgsl+wiki+wolfram+wren+xeora+xml-doc+xojo+xquery+yaml+yang+zig&plugins=highlight-keywords */
code[class*=language-],pre[class*=language-]{color:#000;background:0 0;text-shadow:0 1px #fff;font-family:Consolas,Monaco,'Andale Mono','Ubuntu Mono',monospace;font-size:1em;text-align:left;white-space:pre-wrap;word-spacing:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-] ::-moz-selection,code[class*=language-]::-moz-selection,pre[class*=language-] ::-moz-selection,pre[class*=language-]::-moz-selection{text-shadow:none;background:#b3d4fc}code[class*=language-] ::selection,code[class*=language-]::selection,pre[class*=language-] ::selection,pre[class*=language-]::selection{text-shadow:none;background:#b3d4fc}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{padding:16px;margin:0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#f5f2f0}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.token.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{color:#9a6e3a;background:hsla(0,0%,100%,.5)}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.class-name,.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}

        

        .prompt {
            flex-direction: row;
            letter-spacing: .0015em;
            font-size: 16px;
            font-weight: 400;
            line-height: 24px;
            margin-left: 0;
            margin-right: 0;
        }
        

        .prompt-content {
            padding: 15px;
            overflow: hidden;
            flex: 1 1 auto;
        }
        

        .prompt-content-p p {
            margin-block-start: 0;
            margin-block-end: 0;
        }
        

        .prompt-icon {
            flex: 0 0 auto;
            margin-left: 15px;
            margin-top: 15px;
            fill: currentcolor;
            width: 24px;
            height: 24px;
        }
        

        :root {
            width: 95%;
            max-width: 95vw;
            padding: 0 0 0 30px;
        }
        
        body {
            font-family: JetBrains Sans,serif;
        }
        
        a {
            overflow-wrap: anywhere;
            width: 100vw;
        }
        
        
        @font-face {
            font-family: JetBrains Sans;
            src: url(https://resources.jetbrains.com/storage/jetbrains-sans/JetBrainsSans-Light.woff2) format("woff2"), url(https://resources.jetbrains.com/storage/jetbrains-sans/JetBrainsSans-Light.woff) format("woff");
            font-weight: 300;
            font-style: normal;
        }

        @font-face {
            font-family: JetBrains Sans;
            src: url(https://resources.jetbrains.com/storage/jetbrains-sans/JetBrainsSans-Regular.woff2) format("woff2"), url(https://resources.jetbrains.com/storage/jetbrains-sans/JetBrainsSans-Regular.woff) format("woff");
            font-weight: 400;
            font-style: normal;
        }

        @font-face {
            font-family: JetBrains Sans;
            src: url(https://resources.jetbrains.com/storage/jetbrains-sans/JetBrainsSans-SemiBold.woff2) format("woff2"), url(https://resources.jetbrains.com/storage/jetbrains-sans/JetBrainsSans-SemiBold.woff) format("woff");
            font-weight: 600;
            font-style: normal;
        }
        
        
        code {
            display: inline;
            word-break: break-word;
            font-size: 15px;
            line-height: inherit;
            font-variant-ligatures: none;
            font-family: JetBrains Sans,monospace;
            white-space: pre-line;
            overflow-wrap: break-word;
        }
        
        figcaption {
            margin-top: 5px;
        }
        
        h2 {
            padding-top: 16px;
            padding-bottom: 8px;
            margin-block-start: 0;
            margin-block-end: 0;
        }
        
        h3 {
            padding-top: 8px;
            padding-bottom: 8px;
            margin-block-start: 0;
            margin-block-end: 0;
        }
        
        h4 {
            padding-top: 4px;
            padding-bottom: 8px;
            margin-block-start: 0;
            margin-block-end: 0;
        }
        
        p {
            padding: 0;
            border: 0;
            line-height: 25px;
            margin-block-start: 0;
            margin-block-end: 0;
            padding-bottom: 8px;
        }
        
        div {
            display: block;
        }
        
        table {
            border-collapse: collapse;
            width: 100%;
            page-break-inside: avoid;
        }
        
        th, td {
            border: 1px solid #c4c4c4;
            padding: 10px;
            text-align: left;
            word-break: break-all;
        }
        
        .no-bold {
            font-weight: normal; 
        }
        
        .entry {
            display: grid;
            grid-template-columns: auto max-content;
            grid-template-areas: "chapter page";
            align-items: end;
            gap: 0 .25rem;
            line-height: 25px;
        }
        
        .toc-link-container{
            grid-area: chapter;
            position: relative;
            overflow: hidden;
        }
        
        .toc-link{
            text-decoration: none;
            color: black;
        }
        
        .toc-link-container::after {
            position: absolute;
            padding-left: .25ch;
            content: " . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . "
            ". . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . "
            ". . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . ";
            text-align: right;
        }
        
        .page {
            grid-area: page;
            width: 30px;
            text-align: right;
        }
        

        .tab-content {
            padding: 16px;
        }
        
        .tab-content > *  {
            border: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        

        .tab-title  {
            font-size: 20px;
            margin-bottom: 10px;
        }
        

        .table-wrapper {
            overflow: hidden;
            box-sizing: border-box;
            font: inherit;
        }
        

        .tip {
            background-color: rgba(25, 25, 28, .05);
        }
        

        .tldr {
            display: inline-flex;
            flex-flow: column nowrap;
            justify-content: flex-start;
            align-items: flex-start;
            width: 100%;
            max-width: 100vw;
            padding: 16px;
            border: 1px solid #d1d1d2;
            border-radius: 6px
        }
        
        .tldr p {
            margin: 0;
            padding-bottom: 0;
        }
        

        .topic {
            page-break-before: always;
        }
        

        .warning {
            background: rgba(244, 92, 74, .2);
        }
        </style><title>pdfSourceCABE</title></head><body><div><section class="topic"><div><article class="article"><h1 class="main-title">Table of Contents</h1><div class="entry"><div class="toc-link-container"><a class="toc-link" href="#3045665">Cabe</a></div><div class="page">2</div></div></article></div></section><section class="topic"><div><article class="article"><h1 class="main-title" id="3045665">Cabe</h1><div class="tldr detached" id="3045665#kdeo4c_6"><p><b id="3045665#kdeo4c_16">TLDR</b></p><p id="3045665#kdeo4c_17">Add this to your Gradle build file to add automatic null-checks to the public API of your project and assertion based null checks to the private API:</p><div id="3045665#kdeo4c_18"><div class="detached" id="3045665#kdeo4c_20"><div class="tab-title"><div>Kotlin DSL</div></div><div class="bordered-element tab-content"><div class="detached code-block" id="3045665#kdeo4c_21"><pre><code class="language-kotlin">plugins {
  id(&quot;com.dua3.cabe&quot;) version &quot;3.0-rc&quot;
}</code></pre></div></div></div></div><p id="3045665#kdeo4c_19">Read on for examples and more detailed configuration options.</p></div><p id="3045665#kdeo4c_3">Cabe is a Java byte code instrumentation tool that inserts checks based on JSpecify annotations into your class files.</p><p id="3045665#kdeo4c_4">According to the Fail-Fast Principle (<a href="https://www.martinfowler.com/ieeeSoftware/failFast.pdf">https://www.martinfowler.com/ieeeSoftware/failFast.pdf</a>), all invalid input should be detected and reported early. Cabe helps you doing this by automatically checking method and constructor parameters.</p><p id="3045665#kdeo4c_5">Cabe also helps you during develompment by checking return values of methods.</p><section><h2 id="3045665#what-are-jspecify-annotations" data-toc="what-are-jspecify-annotations#cabe.md-what-are-jspecify-annotations">What are JSpecify Annotations?</h2><p id="3045665#kdeo4c_22">JSpecify is a project that aims to enhance Java code by providing a set of annotations specifically designed to improve code quality and facilitate better type-checking. These annotations help developers specify nullability and (later) other type-related constraints more precisely, allowing for more robust and error-free code. This ultimately leads to improved documentation, better IDE support, and more reliable results during static analysis.</p><p id="3045665#kdeo4c_23">You can find more details about JSpecify on their official website (<a href="https://jspecify.dev">https://jspecify.dev</a>).</p></section><section><h2 id="3045665#what-does-cabe-do" data-toc="what-does-cabe-do#cabe.md-what-does-cabe-do">What does Cabe do?</h2><p id="3045665#kdeo4c_25">Cabe analyzes your classes byte code and injects code that checks for violations of the nullability rules you added to your code by using JSpecify annotations.</p><blockquote class="prompt flex bordered-element-rounded tip detached">
  <svg xmlns="http://www.w3.org/2000/svg" class="prompt-icon">
    <path d="M12.946 3.552L21.52 18.4c.424.735.33 1.6-.519 1.6H3.855c-.85 0-1.817-.865-1.392-1.6l8.573-14.848a1.103 1.103 0 0 1 1.91 0zm.545 12.948a1.5 1.5 0 1 0-1.5 1.5 1.5 1.5 0 0 0 1.5-1.5zM13 8h-2v5h2z"></path>
  </svg>
  <div class="prompt-content prompt-content-p"><p>The example projects here are contained within the &quot;examples&quot; subproject. To compile and run the examples, use the commmand <span class="inline-code" id="3045665#kdeo4c_42">./gradlew -Dexamples examples:&lt;name&gt;:run</span> from the project's main folder.</p></div>
</blockquote>
<blockquote class="prompt flex bordered-element-rounded warning detached">
  <svg xmlns="http://www.w3.org/2000/svg" class="prompt-icon">
    <path d="M12.946 3.552L21.52 18.4c.424.735.33 1.6-.519 1.6H3.855c-.85 0-1.817-.865-1.392-1.6l8.573-14.848a1.103 1.103 0 0 1 1.91 0zm.545 12.948a1.5 1.5 0 1 0-1.5 1.5 1.5 1.5 0 0 0 1.5-1.5zM13 8h-2v5h2z"></path>
  </svg>
  <div class="prompt-content prompt-content-p"><p>Note that running the examples will usually result in a failure as the axamples demonstrate how using Cabe asserts your programs fail-fast when nullability violations are detected.</p></div>
</blockquote>
<p id="3045665#kdeo4c_28">Let's look at an example (use <span class="inline-code" id="3045665#kdeo4c_43">./gradlew :examples:hello:run</span> to execute):</p><div class="detached code-block" id="3045665#kdeo4c_29"><pre><code class="language-java">import org.jspecify.annotations.NonNull;

public class hello.Hello {
    public static void main(String[] args) {
        sayHello(null);
    }

    public static void sayHello(@NonNull String name) {
        System.out.println(&quot;hello.Hello, &quot; + name + &quot;!&quot;);
    }
}</code></pre></div><p id="3045665#kdeo4c_30">The contract of <span class="inline-code" id="3045665#kdeo4c_44">sayHello(@NonNull String name)</span> is that <span class="inline-code" id="3045665#kdeo4c_45">name</span> must have a non-null value when called. When you run this code through Cabe, using the standard configuration, an automatic null-check will be inserted, and when you run the program, you will see this:</p><div class="detached code-block" id="3045665#kdeo4c_31"><pre><code class="language-none">Exception in thread &quot;main&quot; java.lang.NullPointerException: name is null
at hello.Hello.sayHello(hello.Hello.java)
at hello.Hello.main(hello.Hello.java:5)</code></pre></div><p id="3045665#kdeo4c_32">You can of course obtain the same result by using this code:</p><div class="detached code-block" id="3045665#kdeo4c_33"><pre><code class="language-java">public void printGreeting(@NonNull String name) {
    Objects.requireNonNull(name, &quot;name is null&quot;);
    System.out.println(&quot;hello.Hello, &quot; + name);
}</code></pre></div><p id="3045665#kdeo4c_34">Have a look at <span class="inline-code" id="3045665#kdeo4c_46">hellofx</span> for another example. In this example, the program is trying to read a resource from the classpath that can not be found. When not using Cabe, the stack trace will look like this:</p><div class="detached code-block" id="3045665#kdeo4c_35"><pre><code class="language-none">Exception in Application start method
java.lang.reflect.InvocationTargetException
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:118)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at javafx.graphics/com.sun.javafx.application.LauncherImpl.launchApplicationWithArgs(LauncherImpl.java:464)
	at javafx.graphics/com.sun.javafx.application.LauncherImpl.launchApplication(LauncherImpl.java:364)
	at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
	at java.base/java.lang.reflect.Method.invoke(Method.java:580)
	at java.base/sun.launcher.LauncherHelper$FXHelper.main(LauncherHelper.java:1149)
Caused by: java.lang.RuntimeException: Exception in Application start method
	at javafx.graphics/com.sun.javafx.application.LauncherImpl.launchApplication1(LauncherImpl.java:893)
	at javafx.graphics/com.sun.javafx.application.LauncherImpl.lambda$launchApplication$2(LauncherImpl.java:196)
	at java.base/java.lang.Thread.run(Thread.java:1583)
Caused by: java.lang.NullPointerException: Input stream must not be null
	at javafx.graphics/javafx.scene.image.Image.validateInputStream(Image.java:1140)
	at javafx.graphics/javafx.scene.image.Image.&lt;init&gt;(Image.java:707)
	at hellofx.HelloFX.loadImage(HelloFX.java:21)
	at hellofx.HelloFX.start(HelloFX.java:28)
	at javafx.graphics/com.sun.javafx.application.LauncherImpl.lambda$launchApplication1$9(LauncherImpl.java:839)
	at javafx.graphics/com.sun.javafx.application.PlatformImpl.lambda$runAndWait$12(PlatformImpl.java:483)
	at javafx.graphics/com.sun.javafx.application.PlatformImpl.lambda$runLater$10(PlatformImpl.java:456)
	at java.base/java.security.AccessController.doPrivileged(AccessController.java:400)
	at javafx.graphics/com.sun.javafx.application.PlatformImpl.lambda$runLater$11(PlatformImpl.java:455)
	at javafx.graphics/com.sun.glass.ui.InvokeLaterDispatcher$Future.run(InvokeLaterDispatcher.java:95)
Exception running application hellofx.HelloFX</code></pre></div><p id="3045665#kdeo4c_36">The stacktrace indicates an error happened inside a JavaFX method, two methods down in the stack, our method <span class="inline-code" id="3045665#kdeo4c_47">loadImage()</span> appears. When we now open our IDE and look at the actual code, it becomes apparent that the real problem lies in <span class="inline-code" id="3045665#kdeo4c_48">getResourceAsStream()</span> returning <span class="inline-code" id="3045665#kdeo4c_49">null</span> and not a valid streeam.</p><p id="3045665#kdeo4c_37">Now what happens if Cabe is used? We will get this stacktrace:</p><div class="detached code-block" id="3045665#kdeo4c_38"><pre><code class="language-none">Exception in Application start method
java.lang.reflect.InvocationTargetException
        at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:118)
        at java.base/java.lang.reflect.Method.invoke(Method.java:580)
        at javafx.graphics/com.sun.javafx.application.LauncherImpl.launchApplicationWithArgs(LauncherImpl.java:464)
        at javafx.graphics/com.sun.javafx.application.LauncherImpl.launchApplication(LauncherImpl.java:364)
        at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)
        at java.base/java.lang.reflect.Method.invoke(Method.java:580)
        at java.base/sun.launcher.LauncherHelper$FXHelper.main(LauncherHelper.java:1149)
Caused by: java.lang.RuntimeException: Exception in Application start method
        at javafx.graphics/com.sun.javafx.application.LauncherImpl.launchApplication1(LauncherImpl.java:893)
        at javafx.graphics/com.sun.javafx.application.LauncherImpl.lambda$launchApplication$2(LauncherImpl.java:196)
        at java.base/java.lang.Thread.run(Thread.java:1583)
Caused by: java.lang.AssertionError: invalid null return value
        at hellofx.HelloFX.getResourceAsStream(HelloFX.java:19)
        at hellofx.HelloFX.loadImage(HelloFX.java:23)
        at hellofx.HelloFX.start(HelloFX.java:31)
        at javafx.graphics/com.sun.javafx.application.LauncherImpl.lambda$launchApplication1$9(LauncherImpl.java:839)
        at javafx.graphics/com.sun.javafx.application.PlatformImpl.lambda$runAndWait$12(PlatformImpl.java:483)
        at javafx.graphics/com.sun.javafx.application.PlatformImpl.lambda$runLater$10(PlatformImpl.java:456)
        at java.base/java.security.AccessController.doPrivileged(AccessController.java:400)
        at javafx.graphics/com.sun.javafx.application.PlatformImpl.lambda$runLater$11(PlatformImpl.java:455)
        at javafx.graphics/com.sun.glass.ui.InvokeLaterDispatcher$Future.run(InvokeLaterDispatcher.java:95)</code></pre></div><p id="3045665#kdeo4c_39">Note that the cause now points directly at the exact method that returned the invalid <span class="inline-code" id="3045665#kdeo4c_50">null</span> value. This is of course a rather trivial example, but it shows how Cabe can simplify your workflow.</p><blockquote class="prompt flex bordered-element-rounded tip detached">
  <svg xmlns="http://www.w3.org/2000/svg" class="prompt-icon">
    <path d="M12.946 3.552L21.52 18.4c.424.735.33 1.6-.519 1.6H3.855c-.85 0-1.817-.865-1.392-1.6l8.573-14.848a1.103 1.103 0 0 1 1.91 0zm.545 12.948a1.5 1.5 0 1 0-1.5 1.5 1.5 1.5 0 0 0 1.5-1.5zM13 8h-2v5h2z"></path>
  </svg>
  <div class="prompt-content prompt-content-p"><p>If you look at the HelloFX source code, you might notice that the method return value was not even marked as <span class="inline-code" id="3045665#kdeo4c_51">@NonNull</span>. Instead the class was marked as <span class="inline-code" id="3045665#kdeo4c_52">@NullMarked</span>. This basically means that unless something is explicitly marked as <span class="inline-code" id="3045665#kdeo4c_53">@Nullable</span>, everything inside that class is implicitly treated as if it were annotated as <span class="inline-code" id="3045665#kdeo4c_54">@NonNull</span>.</p></div>
</blockquote>
<blockquote class="prompt flex bordered-element-rounded note detached">
  <svg xmlns="http://www.w3.org/2000/svg" class="prompt-icon">
    <path d="M21 12a9 9 0 1 1-9-9 9 9 0 0 1 9 9zM10.5 7.5A1.5 1.5 0 1 0 12 6a1.5 1.5 0 0 0-1.5 1.5zm-.5 3.54v1h1V18h2v-6a.96.96 0 0 0-.96-.96z"></path>
  </svg>
  <div class="prompt-content prompt-content-p"><p>The <span class="inline-code" id="3045665#kdeo4c_55">@NullMarked</span> annotation can be applied to classes, packages, and even Jigsaw modules. Read more about how to use JSpecify annotations in the Nullness User Guide (<a href="https://jspecify.dev/docs/user-guide/">https://jspecify.dev/docs/user-guide/</a>).</p></div>
</blockquote>
</section><section><h2 id="3045665#will-using-cabe-impact-performance" data-toc="will-using-cabe-impact-performance#cabe.md-will-using-cabe-impact-performance">Will using Cabe impact performance?</h2><p id="3045665#kdeo4c_57">Depending on the configuration used, there may be a minor overhead. Depending on your requirements, you can use different configurations.</p><ul class="list" id="3045665#kdeo4c_58" start="1"><li class="list-item" id="3045665#kdeo4c_60"><p id="3045665#kdeo4c_63">During development, it is recommended to enable all checks so that programming errors will show up during early testing.</p></li><li class="list-item" id="3045665#kdeo4c_61"><p id="3045665#kdeo4c_64">Once you are certain your project is thoroughly tested, you can restrict parameter checking to methods called by third-party code. When the standard setting is used, parameters to private API methods are checked using standard assertions that can be enabled or disabled at runtime. Standard assertions are usually optimized out by the JIT compiler when assertions are disabled. There may still be a minor impact due to increased class file size.</p></li><li class="list-item" id="3045665#kdeo4c_62"><p id="3045665#kdeo4c_65">You can also disable all checks by using the <span class="inline-code" id="3045665#kdeo4c_66">NO_CHECK</span> configuration and there will be no performance hit at all. Be aware that you might trade correctness to speed in this case as invalid inputs will not be detected.</p></li></ul><p id="3045665#kdeo4c_59">When in doubt, profile your application when compiled using the different settings.</p></section><section><h2 id="3045665#how-are-null-checks-implemented" data-toc="how-are-null-checks-implemented#cabe.md-how-are-null-checks-implemented">How are Null Checks implemented?</h2><p id="3045665#kdeo4c_67">This depends on the configuration used. There are four types of checks. The examples assume a non-nullable parameter #named <span class="inline-code" id="3045665#kdeo4c_69">p</span>.</p><div class="table-wrapper detached"><table id="3045665#kdeo4c_68"><tr class="header-row" id="3045665#kdeo4c_70"><th id="3045665#kdeo4c_75"><p>Check</p></th><th id="3045665#kdeo4c_76"><p>Equivalent Java code</p></th></tr><tr class="" id="3045665#kdeo4c_71"><td id="3045665#kdeo4c_77"><p>NO_CHECK</p></td><td id="3045665#kdeo4c_78"><p>[N/A]</p></td></tr><tr class="" id="3045665#kdeo4c_72"><td id="3045665#kdeo4c_79"><p>STANDARD_ASSERTION</p></td><td id="3045665#kdeo4c_80"><p><span class="inline-code" id="3045665#kdeo4c_81">assert p!=null : &quot;p is null&quot;;</span></p></td></tr><tr class="" id="3045665#kdeo4c_73"><td id="3045665#kdeo4c_82"><p>ASSERT_ALWAYS</p></td><td id="3045665#kdeo4c_83"><p><span class="inline-code" id="3045665#kdeo4c_84">if (p==null) throw new AssertionError(&quot;p is null&quot;);</span></p></td></tr><tr class="" id="3045665#kdeo4c_74"><td id="3045665#kdeo4c_85"><p>THROW_NPE</p></td><td id="3045665#kdeo4c_86"><p><span class="inline-code" id="3045665#kdeo4c_87">if (p==null) throw new NullPointerException(&quot;p is null&quot;);</span></p></td></tr></table></div></section><section><h2 id="3045665#public-vs-private-api" data-toc="public-vs-private-api#cabe.md-public-vs-private-api">Public vs Private API</h2><p id="3045665#kdeo4c_88">When developing a library, you can configure different checks for:</p><ul class="list" id="3045665#kdeo4c_89" start="1"><li class="list-item" id="3045665#kdeo4c_91"><p id="3045665#kdeo4c_93">the <span class="control" id="3045665#kdeo4c_94">public API</span> of your library so that invalid parameter values are detected when the user of your library calls your code with disallowed <span class="inline-code" id="3045665#kdeo4c_95">null</span> values for a parameter,</p></li><li class="list-item" id="3045665#kdeo4c_92"><p id="3045665#kdeo4c_96">the <span class="control" id="3045665#kdeo4c_97">private API</span> of your library, i.e., code that cannot be directly called by users of your library.</p></li></ul><blockquote class="prompt flex bordered-element-rounded note detached">
  <svg xmlns="http://www.w3.org/2000/svg" class="prompt-icon">
    <path d="M21 12a9 9 0 1 1-9-9 9 9 0 0 1 9 9zM10.5 7.5A1.5 1.5 0 1 0 12 6a1.5 1.5 0 0 0-1.5 1.5zm-.5 3.54v1h1V18h2v-6a.96.96 0 0 0-.96-.96z"></path>
  </svg>
  <div class="prompt-content prompt-content-p"><p>In the standard configuration, parameters that are part of the public API will always be checked and throw a <span class="inline-code" id="3045665#kdeo4c_98">NnullPointerException</span> when an <span class="inline-code" id="3045665#kdeo4c_99">null</span> parameter value is detected where it is not allowed and for parts of your private API, standard assertions are used that can be enabled at runtime using the standard <span class="inline-code" id="3045665#kdeo4c_100">-ea</span> flag.</p></div>
</blockquote>
</section><section><h2 id="3045665#what-are-the-predefined-configurations" data-toc="what-are-the-predefined-configurations#cabe.md-what-are-the-predefined-configurations">What are the predefined configurations?</h2><p id="3045665#kdeo4c_101">The predefined configurations are:</p><div class="table-wrapper detached"><table id="3045665#kdeo4c_102"><tr class="header-row" id="3045665#kdeo4c_103"><th id="3045665#kdeo4c_107"><p>Name</p></th><th id="3045665#kdeo4c_108"><p>Public API</p></th><th id="3045665#kdeo4c_109"><p>Private API</p></th><th id="3045665#kdeo4c_110"><p>Return Values</p></th></tr><tr class="" id="3045665#kdeo4c_104"><td id="3045665#kdeo4c_111"><p>DEVELOPMENT</p></td><td id="3045665#kdeo4c_112"><p>ASSERT_ALWAYS</p></td><td id="3045665#kdeo4c_113"><p>ASSERT_ALWAYS</p></td><td id="3045665#kdeo4c_114"><p>ASSERT_ALWAYS</p></td></tr><tr class="" id="3045665#kdeo4c_105"><td id="3045665#kdeo4c_115"><p>STANDARD</p></td><td id="3045665#kdeo4c_116"><p>THROW_NPE</p></td><td id="3045665#kdeo4c_117"><p>ASSERT</p></td><td id="3045665#kdeo4c_118"><p>NO_CHECK</p></td></tr><tr class="" id="3045665#kdeo4c_106"><td id="3045665#kdeo4c_119"><p>NO_CHECK</p></td><td id="3045665#kdeo4c_120"><p>NO_CHECK</p></td><td id="3045665#kdeo4c_121"><p>NO_CHECK</p></td><td id="3045665#kdeo4c_122"><p>NO_CHECK</p></td></tr></table></div></section><section><h2 id="3045665#things-to-note" data-toc="things-to-note#cabe.md-things-to-note">Things to note</h2><p id="3045665#kdeo4c_123">Here are some points that you should be aware of when using Cabe.</p><section><h3 id="3045665#records" data-toc="records#cabe.md-records">Records</h3><p id="3045665#kdeo4c_130">Cabe supports Java Records.</p><section><h4 id="3045665#do-i-need-to-explicitly-add-a-record-constructor-so-that-parameters-can-be-checked" data-toc="do-i-need-to-explicitly-add-a-record-constructor-so-that-parameters-can-be-checked#cabe.md-do-i-need-to-explicitly-add-a-record-constructor-so-that-parameters-can-be-checked">Do I need to explicitly add a Record Constructor so that Parameters can be checked?</h4><p id="3045665#kdeo4c_133">No, Cabe adds the checks by evaluating the record declaration:</p><div class="detached code-block" id="3045665#kdeo4c_134"><pre><code class="language-java">record MyRecord(@NonNull String a, @Nullable String b) {}

void foo() {
    // this works
    MyRecord r1 = new MyRecord(&quot;a&quot;, null);
    // this will throw an exception &quot;a is null&quot;
    MyRecord r1 = new MyRecord(null, &quot;b&quot;);
}</code></pre></div></section><section><h4 id="3045665#standard-assertions-cannot-be-generated-for-record-classes" data-toc="standard-assertions-cannot-be-generated-for-record-classes#cabe.md-standard-assertions-cannot-be-generated-for-record-classes">Standard Assertions cannot be generated for Record classes</h4><p id="3045665#kdeo4c_135">Cabe currently cannot inject standard assertions into record classes because of technical restrictions. That is why for records, THROW_NPE is used instead of ASSERT. ASSERT_ALWAYS works as it does for other classes.</p><p id="3045665#kdeo4c_136"><span class="control" id="3045665#kdeo4c_139">Technical background</span></p><p id="3045665#kdeo4c_137">Standard assertions use a special boolean flag <span class="inline-code" id="3045665#kdeo4c_140">$assertionsDisabled</span> that is initialised by the JVM when the class is loaded to the value obtained by calling <span class="inline-code" id="3045665#kdeo4c_141">Class.getDesiredAssertionStatus()</span>.</p><p id="3045665#kdeo4c_138">For classes that do not contain any assertions in their source code, this flag is not present in the class file and has to be injected into the byte code. the initialisation is then done in a static initializer block. This does not work for records and results in an <span class="inline-code" id="3045665#kdeo4c_142">InvalidClassFileException</span>.</p></section></section><section><h3 id="3045665#arrays" data-toc="arrays#cabe.md-arrays">Arrays</h3><p id="3045665#kdeo4c_143">Cabe will detect when <span class="inline-code" id="3045665#kdeo4c_145">null</span> is passed for a non-nullable array parameter. It will however not detect null values contained in an array.</p><div class="detached code-block" id="3045665#kdeo4c_144"><pre><code class="language-java">void foo(@NonNull String[] array) {}
void bar(@NonNull String @NonNull[] array) {}

void test() {
    // exception will be thrown
    foo(null);
    // no exception will be thrown although null elements are disallowed
    bar(new String[] {&quot;123&quot;, null});
}</code></pre></div></section><section><h3 id="3045665#generics" data-toc="generics#cabe.md-generics">Generics</h3><p id="3045665#kdeo4c_146">Cabe will detect violations for generic parameters when it can be determined at compile time that a type is non nullable:</p><div class="detached code-block" id="3045665#kdeo4c_147"><pre><code class="language-java">@NullMarked
class Generic&lt;T, U extends @Nullable String&gt; {

    void foo(T t, U u) {}

    void test() {
        // will throw a NullPointerException
        foo(null, &quot;u&quot;);

        // will not throw
        foo(&quot;t&quot;, null);
    }
}</code></pre></div><p id="3045665#kdeo4c_148">If cannot check parameters where the nullability can not be determined at compile time:</p><div class="detached code-block" id="3045665#kdeo4c_149"><pre><code class="language-java">@NullUnmarked
class Generic2&lt;T&gt; {
    void foo(T t) {}
}

{
    // this does not throw, null is allowed
    new Generic2&lt;String&gt;().foo(null);

    // this also does not throw because the nullability can not be determined at compile time of foo() 
    new Generic2&lt;@NonNull String&gt;().foo(null);
}</code></pre></div></section><section><h3 id="3045665#spotbugs" data-toc="spotbugs#cabe.md-spotbugs">SpotBugs</h3><p id="3045665#kdeo4c_150">If you use SpotBugs in your build, it may report unnecessary null checks, i.e., when Cabe is configured to check method return values and SpotBugs byte code analysis infers the checked value will be non-null anyway. In that case, you might want to use a SpotBugs exclusion file.</p><div class="detached code-block" id="3045665#kdeo4c_151"><pre><code class="language-markup">&lt;FindBugsFilter&gt;
    &lt;Match&gt;
        &lt;!-- Bugs reported by SpotBugs for automatic injected null checks --&gt;
        &lt;Or&gt;
            &lt;Bug pattern=&quot;RCN_REDUNDANT_NULLCHECK_WOULD_HAVE_BEEN_A_NPE&quot;/&gt;
            &lt;Bug pattern=&quot;RCN_REDUNDANT_COMPARISON_OF_NULL_AND_NONNULL_VALUE&quot;/&gt;
            &lt;Bug pattern=&quot;SA_LOCAL_SELF_ASSIGNMENT&quot; /&gt;
        &lt;/Or&gt;
    &lt;/Match&gt;
&lt;/FindBugsFilter&gt;</code></pre></div></section><section><h3 id="3045665#using-cabe-in-your-gradle-build" data-toc="using-cabe-in-your-gradle-build#cabe.md-using-cabe-in-your-gradle-build">Using Cabe in your Gradle Build</h3><p id="3045665#kdeo4c_152">Cabe can be used either as a standalone program that you can run manually to instrument your class files or as a Gradle plugin that runs automatically in your build process. Let's see how it is done with Gradle.</p><p id="3045665#kdeo4c_153">To use Cabe in your Gradle build, add the plugin to your build script and configure the plugin:</p><div id="3045665#kdeo4c_154"><div class="detached" id="3045665#kdeo4c_158"><div class="tab-title"><div>Kotlin DSL</div></div><div class="bordered-element tab-content"><div class="detached code-block" id="3045665#kdeo4c_160"><pre><code class="language-kotlin">plugins {
  id(&quot;com.dua3.cabe&quot;) version &quot;3.0-rc&quot;
}</code></pre></div></div></div><div class="detached" id="3045665#kdeo4c_159"><div class="tab-title"><div>Groovy DSL</div></div><div class="bordered-element tab-content"><div class="detached code-block" id="3045665#kdeo4c_161"><pre><code class="language-groovy">plugins {
  id &quot;com.dua3.cabe&quot; version &quot;3.0-rc&quot;
}</code></pre></div></div></div></div><p id="3045665#kdeo4c_155">This will run the Cabe processor in your build. When no configuration is given, a standard configuration is used.</p><section><h4 id="3045665#configure-the-cabe-task" data-toc="configure-the-cabe-task#cabe.md-configure-the-cabe-task">Configure the Cabe Task</h4><p id="3045665#kdeo4c_162">To configure the instrumentation, you can configure Cabe like this to use one of the predefined configurations:</p><div id="3045665#kdeo4c_163"><div class="detached" id="3045665#kdeo4c_165"><div class="tab-title"><div>Kotlin DSL</div></div><div class="bordered-element tab-content"><div class="detached code-block" id="3045665#kdeo4c_166"><pre><code class="language-kotlin">cabe {
    config.set(Configuration.STANDARD)
}</code></pre></div></div></div></div><p id="3045665#kdeo4c_164">If you omit the configuration block in your build, the standard configuration will be used.</p></section><section><h4 id="3045665#using-different-configurations-for-development-and-release-builds" data-toc="using-different-configurations-for-development-and-release-builds#cabe.md-using-different-configurations-for-development-and-release-builds">Using different Configurations for Development and Release Builds</h4><p id="3045665#kdeo4c_167">You can also automatically select a configuration based on your version string. In this example, strict checking is done for snapshot and beta versions whereas a release build will use the standard configuration:</p><div id="3045665#kdeo4c_168"><div class="detached" id="3045665#kdeo4c_169"><div class="tab-title"><div>Kotlin DSL</div></div><div class="bordered-element tab-content"><div class="detached code-block" id="3045665#kdeo4c_170"><pre><code class="language-kotlin">val isSnapshot = project.version.toString().toDefaultLowerCase().contains(&quot;snapshot&quot;)
cabe {
    if (isSnapshot) {
        config.set(Configuration.DEVELOPMENT)
    } else {
        config.set(Configuration.STANDARD)
    }
}</code></pre></div></div></div></div></section></section><section><h3 id="3045665#defining-custom-configurations" data-toc="defining-custom-configurations#cabe.md-defining-custom-configurations">Defining Custom Configurations</h3><p id="3045665#kdeo4c_171">You can define a custom configuration that differs from the provided predefined configurations by providing a configuration String:</p><div class="detached code-block" id="3045665#kdeo4c_172"><pre><code class="language-kotlin">cabe {
    config.set(Configuration.parse(&quot;publicApi=THROW_NPE:privateApi=ASSERT:returnValue=ASSERT_ALWAYS&quot;))
}</code></pre></div><p id="3045665#kdeo4c_173">When using a configuration String, you can use either</p><ul class="list" id="3045665#kdeo4c_174" start="1"><li class="list-item" id="3045665#kdeo4c_179"><p>a predefined name: &quot;STANDARD&quot;, &quot;DEVELOPMEN&quot;, &quot;NOCHECKSS&quot;</p></li><li class="list-item" id="3045665#kdeo4c_180"><p>a single Check to be used public and private API and return values</p></li><li class="list-item" id="3045665#kdeo4c_181"><p>multiple combination of keys (&quot;publicApi&quot;, &quot;privateApi&quot;, &quot;returnValue&quot;) and checks; in this the remaining will be set to &quot;NO_CHECK&quot;</p></li></ul><p id="3045665#kdeo4c_175">Examples:</p><div class="table-wrapper detached"><table id="3045665#kdeo4c_176"><tr class="header-row" id="3045665#kdeo4c_182"><th id="3045665#kdeo4c_193"><p>Configuration String</p></th><th id="3045665#kdeo4c_194"><p>Public API</p></th><th id="3045665#kdeo4c_195"><p>Private API</p></th><th id="3045665#kdeo4c_196"><p>Return Value</p></th></tr><tr class="" id="3045665#kdeo4c_183"><td id="3045665#kdeo4c_197"><p>&quot;STANDARD&quot;</p></td><td id="3045665#kdeo4c_198"><p>THROW_NPE</p></td><td id="3045665#kdeo4c_199"><p>ASSERT</p></td><td id="3045665#kdeo4c_200"><p>NO_CHECK</p></td></tr><tr class="" id="3045665#kdeo4c_184"><td id="3045665#kdeo4c_201"><p>&quot;DEVELOPMENT&quot;</p></td><td id="3045665#kdeo4c_202"><p>ASSERT_ALWAYS</p></td><td id="3045665#kdeo4c_203"><p>ASSERT_ALWAYS</p></td><td id="3045665#kdeo4c_204"><p>ASSERT_ALWAYS</p></td></tr><tr class="" id="3045665#kdeo4c_185"><td id="3045665#kdeo4c_205"><p>&quot;NO_CHECKS&quot;</p></td><td id="3045665#kdeo4c_206"><p>NO_CHECK</p></td><td id="3045665#kdeo4c_207"><p>NO_CHECK</p></td><td id="3045665#kdeo4c_208"><p>NO_CHECK</p></td></tr><tr class="" id="3045665#kdeo4c_186"><td id="3045665#kdeo4c_209"><p>&quot;THROW_NPE&quot;</p></td><td id="3045665#kdeo4c_210"><p>THROW_NPE</p></td><td id="3045665#kdeo4c_211"><p>THROW_NPE</p></td><td id="3045665#kdeo4c_212"><p>THROW_NPE</p></td></tr><tr class="" id="3045665#kdeo4c_187"><td id="3045665#kdeo4c_213"><p>&quot;ASSERT&quot;</p></td><td id="3045665#kdeo4c_214"><p>ASSERT</p></td><td id="3045665#kdeo4c_215"><p>ASSERT</p></td><td id="3045665#kdeo4c_216"><p>ASSERT</p></td></tr><tr class="" id="3045665#kdeo4c_188"><td id="3045665#kdeo4c_217"><p>&quot;ASSERT_ALWAYS&quot;</p></td><td id="3045665#kdeo4c_218"><p>ASSERT_ALWAYS</p></td><td id="3045665#kdeo4c_219"><p>ASSERT_ALWAYS</p></td><td id="3045665#kdeo4c_220"><p>ASSERT_ALWAYS</p></td></tr><tr class="" id="3045665#kdeo4c_189"><td id="3045665#kdeo4c_221"><p>&quot;NO_CHECK&quot;</p></td><td id="3045665#kdeo4c_222"><p>NO_CHECK</p></td><td id="3045665#kdeo4c_223"><p>NO_CHECK</p></td><td id="3045665#kdeo4c_224"><p>NO_CHECK</p></td></tr><tr class="" id="3045665#kdeo4c_190"><td id="3045665#kdeo4c_225"><p>&quot;THROW_NPE&quot;</p></td><td id="3045665#kdeo4c_226"><p>THROW_NPE</p></td><td id="3045665#kdeo4c_227"><p>THROW_NPE</p></td><td id="3045665#kdeo4c_228"><p>THROW_NPE</p></td></tr><tr class="" id="3045665#kdeo4c_191"><td id="3045665#kdeo4c_229"><p>&quot;publicApi=THROW_NPE&quot;</p></td><td id="3045665#kdeo4c_230"><p>THROW_NPE</p></td><td id="3045665#kdeo4c_231"><p>NO_CHECK</p></td><td id="3045665#kdeo4c_232"><p>NO_CHECK</p></td></tr><tr class="" id="3045665#kdeo4c_192"><td id="3045665#kdeo4c_233"><p>&quot;publicApi=THROW_NPE:returnValue=ASSERT&quot;</p></td><td id="3045665#kdeo4c_234"><p>THROW_NPE</p></td><td id="3045665#kdeo4c_235"><p>NO_CHECK</p></td><td id="3045665#kdeo4c_236"><p>ASSERT</p></td></tr></table></div><p id="3045665#kdeo4c_177">You can also use the standard record constructor of <span class="inline-code" id="3045665#kdeo4c_237">Configuration</span></p><div class="detached code-block" id="3045665#kdeo4c_178"><pre><code class="language-kotlin">cabe {
    config.set(new Configuration(Check.THROW_NPE, Check.ASSERT, Check.ASSERT_ALWAYS))
}</code></pre></div></section></section><section><h2 id="3045665#what-about-the-name" data-toc="what-about-the-name#cabe.md-what-about-the-name">What about the Name?</h2><p id="3045665#kdeo4c_238">In Javanese, both cabe and lombok refer to chili peppers. At the same time, Lombok is a... well, it's something between a library and a language on its own that extends Java with certain features. One of these features are annotations to mark nullable and non-nullable types and code instrumentation to do runtime checks based on these annotations.</p><p id="3045665#kdeo4c_239">While widely used, Lombok is quite controversial - you will find plenty of discussions on this topic on the internet.</p><p id="3045665#kdeo4c_240">Newer Java versions brought many features that developers used Lombok for, perhaps most notably Java records. But having automated null checks in your code is one Lombok feature that I liked but could not find any non-Lombok alternative. That's why I started Cabe, and that's where the name comes from.</p></section></article></div></section></div></body></html>